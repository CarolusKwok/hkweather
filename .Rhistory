}
ana_p = ana_p + 6
while(ana_t > ana_d){
ana_p = ana_p - 2
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 3
while(ana_t > ana_d){
ana_p = ana_p - 0.02
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.03
while(ana_t > ana_d){
ana_p = ana_p - 0.002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.003
while(ana_t > ana_d){
ana_p = ana_p - 0.0002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.0003
while(ana_t > ana_d){
ana_p = ana_p - 0.00001
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_a = (ana_t + ana_d) / 2
ana_p = enq_dabt(temp1 = org_t, pres1 = org_p, temp2 = ana_a, find = "pres")$pres2
data$lclp[i] = ana_p
data$lclt[i] = ana_a
}
}
#Start calculating the solution
#Calculate dwpt isohume
#rs = (ep * es) / (pres - es)
#rs1 = (ep * es1) / (pres1 - es1)
#rs2 = (ep * es2) / (pres2 - es2)
#if rs1 = rs2
#(ep * es1) / (pres1 - es1) = (ep * es2) / (pres2 - es2)
#(ep * es1) / (pres1 - es1) / ep = es2 / (pres2 - es2)
#(ep * es1) / ((pres1 - es1) * ep) = es2 / pres2 - 1
#es1 / (pres1 - es1) = es2 / pres2 - 1
#es1 / pres1 = es2 / pres2
####sub es into t
#es = e0 * exp((18.678 - (t/234.5)) * (t / (257.14 + t)))
#es1 = e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1)))
#es2 = e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))
#(e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) ) / pres1 =
#  (e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) ) / pres2
#let exp(...)1 be x1
#(e0 * x1) / pres1 = (e0 * x2) / pres2
#x1 / pres1 = x2 / pres2
#x1 / x2 = pres1 / pres2
#exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) / exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  pres1 / pres2
#exp(((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))) =
#  pres1 / pres2
#((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  ln(pres1 / pres2)
#Calculate temp dabt
#pres2 = 10 ^ (log10(temp2K/ temp1K) / RdCp + 3)
data
}
enq_lcl(c(10,13), 20, 1000)
draw_asnd_plot(DABT = 20, IHUM = 9.456227, MABT = F, PRES = c(1000, 900))+
geom_vline(xintercept = 11.353212)+
geom_hline(yintercept = 900.5126)
draw_asnd_plot(DABT = 20, IHUM = 9.456227, MABT = F, PRES = c(1000, 950))+
geom_vline(xintercept = 11.353212)+
geom_hline(yintercept = 900.5126)
draw_asnd_plot(DABT = 20, IHUM = 9.456227, MABT = F, PRES = c(1000, 800))+
geom_vline(xintercept = 11.353212)+
geom_hline(yintercept = 900.5126)
enq_lcl(c(10,21), 20, 1000)
draw_asnd_plot(DABT = 20, IHUM = 9.456227, MABT = F, PRES = c(1000, 800))+
geom_vline(xintercept = 11.353212)+
geom_hline(yintercept = 900.5126)
enq_lcl = function(dwpt, temp, pres){
hkweather::hkw_lib()
data = data.frame(dwpt = dwpt,
temp = temp,
pres = pres,
lclp = NA,
lclt = NA,
rs   = NA,
es   = NA) %>%
mutate(rs = enq_rs(temp = dwpt, pres = pres, find = "rs")$rs)%>%
mutate(es = enq_es(temp = dwpt, find = "es")$es)
for(i in 1:nrow(data)){
org_t = data$temp[i]
org_d = data$dwpt[i]
org_p = data$pres[i]
org_rs = data$rs[i]
ana_p = data$pres[i]
ana_t = data$temp[i]
ana_d = data$dwpt[i]
if(data$dwpt[i] > data$temp[i]){
while(ana_t < ana_d){
ana_p = ana_p + 5
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 6
while(ana_t < ana_d){
ana_p = ana_p + 2
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 3
while(ana_t < ana_d){
ana_p = ana_p + 0.02
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.03
while(ana_t < ana_d){
ana_p = ana_p + 0.002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.003
while(ana_t < ana_d){
ana_p = ana_p + 0.0002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.0003
while(ana_t < ana_d){
ana_p = ana_p + 0.00001
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_a = (ana_t + ana_d) / 2
ana_p = enq_dabt(temp1 = org_t, pres1 = org_p, temp2 = ana_a, find = "pres")$pres2
} else {
while(ana_t > ana_d){
ana_p = ana_p - 5
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 6
while(ana_t > ana_d){
ana_p = ana_p - 2
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 3
while(ana_t > ana_d){
ana_p = ana_p - 0.02
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.03
while(ana_t > ana_d){
ana_p = ana_p - 0.002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.003
while(ana_t > ana_d){
ana_p = ana_p - 0.0002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.0003
while(ana_t > ana_d){
ana_p = ana_p - 0.00001
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_a = (ana_t + ana_d) / 2
ana_p = enq_dabt(temp1 = org_t, pres1 = org_p, temp2 = ana_a, find = "pres")$pres2
}
data$lclp[i] = ana_p
data$lclt[i] = ana_a
}
#Start calculating the solution
#Calculate dwpt isohume
#rs = (ep * es) / (pres - es)
#rs1 = (ep * es1) / (pres1 - es1)
#rs2 = (ep * es2) / (pres2 - es2)
#if rs1 = rs2
#(ep * es1) / (pres1 - es1) = (ep * es2) / (pres2 - es2)
#(ep * es1) / (pres1 - es1) / ep = es2 / (pres2 - es2)
#(ep * es1) / ((pres1 - es1) * ep) = es2 / pres2 - 1
#es1 / (pres1 - es1) = es2 / pres2 - 1
#es1 / pres1 = es2 / pres2
####sub es into t
#es = e0 * exp((18.678 - (t/234.5)) * (t / (257.14 + t)))
#es1 = e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1)))
#es2 = e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))
#(e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) ) / pres1 =
#  (e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) ) / pres2
#let exp(...)1 be x1
#(e0 * x1) / pres1 = (e0 * x2) / pres2
#x1 / pres1 = x2 / pres2
#x1 / x2 = pres1 / pres2
#exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) / exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  pres1 / pres2
#exp(((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))) =
#  pres1 / pres2
#((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  ln(pres1 / pres2)
#Calculate temp dabt
#pres2 = 10 ^ (log10(temp2K/ temp1K) / RdCp + 3)
data
}
enq_lcl(c(10,21), 20, 1000)
draw_asnd_plot(DABT = 20, IHUM = 9.456227, MABT = F, PRES = c(950, 850))+
geom_vline(xintercept = 11.353212)+
geom_hline(yintercept = 900.5126)
draw_asnd_plot(DABT = 20, IHUM = 9.456227, MABT = F, PRES = c(910, 890))+
geom_vline(xintercept = 11.353212)+
geom_hline(yintercept = 900.5126)
draw_asnd_plot(DABT = 20, IHUM = 9.456227, MABT = F, PRES = c(905, 895))+
geom_vline(xintercept = 11.353212)+
geom_hline(yintercept = 900.5126)
library(hkweather)
enq_lcl(c(10,21), 20, 1000)
#' Outputs lclp (LCL, pressure) and lclt (LCL, temperature), in the unit of hPa and deg Celsius.
#'
#' @param dwpt Dewpoint temperature, in degree Celsius
#' @param temp Air temperature, in degree Celsius
#' @param pres Air pressure, in hPa
#'
#' @return
#' @export
#'
#' @examples enq_lcl(c(10,21), 20, 1000)
enq_lcl = function(dwpt, temp, pres){
hkweather::hkw_lib()
data = data.frame(dwpt = dwpt,
temp = temp,
pres = pres,
lclp = NA,
lclt = NA,
rs   = NA,
es   = NA) %>%
mutate(rs = enq_rs(temp = dwpt, pres = pres, find = "rs")$rs)%>%
mutate(es = enq_es(temp = dwpt, find = "es")$es)
for(i in 1:nrow(data)){
org_t = data$temp[i]
org_d = data$dwpt[i]
org_p = data$pres[i]
org_rs = data$rs[i]
ana_p = data$pres[i]
ana_t = data$temp[i]
ana_d = data$dwpt[i]
signs = ifelse(data$dwpt[i] > data$temp[i], +1, -1)
message(signs)
if(data$dwpt[i] > data$temp[i]){
while(ana_t < ana_d){
ana_p = ana_p + 5
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 6
while(ana_t < ana_d){
ana_p = ana_p + 2
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 3
while(ana_t < ana_d){
ana_p = ana_p + 0.02
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.03
while(ana_t < ana_d){
ana_p = ana_p + 0.002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.003
while(ana_t < ana_d){
ana_p = ana_p + 0.0002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.0003
while(ana_t < ana_d){
ana_p = ana_p + 0.00001
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_a = (ana_t + ana_d) / 2
ana_p = enq_dabt(temp1 = org_t, pres1 = org_p, temp2 = ana_a, find = "pres")$pres2
} else {
while(ana_t > ana_d){
ana_p = ana_p - 5
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 6
while(ana_t > ana_d){
ana_p = ana_p - 2
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 3
while(ana_t > ana_d){
ana_p = ana_p - 0.02
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.03
while(ana_t > ana_d){
ana_p = ana_p - 0.002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.003
while(ana_t > ana_d){
ana_p = ana_p - 0.0002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.0003
while(ana_t > ana_d){
ana_p = ana_p - 0.00001
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_a = (ana_t + ana_d) / 2
ana_p = enq_dabt(temp1 = org_t, pres1 = org_p, temp2 = ana_a, find = "pres")$pres2
}
data$lclp[i] = ana_p
data$lclt[i] = ana_a
}
#Start calculating the solution
#Calculate dwpt isohume
#rs = (ep * es) / (pres - es)
#rs1 = (ep * es1) / (pres1 - es1)
#rs2 = (ep * es2) / (pres2 - es2)
#if rs1 = rs2
#(ep * es1) / (pres1 - es1) = (ep * es2) / (pres2 - es2)
#(ep * es1) / (pres1 - es1) / ep = es2 / (pres2 - es2)
#(ep * es1) / ((pres1 - es1) * ep) = es2 / pres2 - 1
#es1 / (pres1 - es1) = es2 / pres2 - 1
#es1 / pres1 = es2 / pres2
####sub es into t
#es = e0 * exp((18.678 - (t/234.5)) * (t / (257.14 + t)))
#es1 = e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1)))
#es2 = e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))
#(e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) ) / pres1 =
#  (e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) ) / pres2
#let exp(...)1 be x1
#(e0 * x1) / pres1 = (e0 * x2) / pres2
#x1 / pres1 = x2 / pres2
#x1 / x2 = pres1 / pres2
#exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) / exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  pres1 / pres2
#exp(((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))) =
#  pres1 / pres2
#((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  ln(pres1 / pres2)
#Calculate temp dabt
#pres2 = 10 ^ (log10(temp2K/ temp1K) / RdCp + 3)
return(data)
}
enq_lcl(c(10,21), 20, 1000)
#' Outputs lclp (LCL, pressure) and lclt (LCL, temperature), in the unit of hPa and deg Celsius.
#'
#' @param dwpt Dewpoint temperature, in degree Celsius
#' @param temp Air temperature, in degree Celsius
#' @param pres Air pressure, in hPa
#'
#' @return
#' @export
#'
#' @examples enq_lcl(c(10,21), 20, 1000)
enq_lcl = function(dwpt, temp, pres){
hkweather::hkw_lib()
data = data.frame(dwpt = dwpt,
temp = temp,
pres = pres,
lclp = NA,
lclt = NA,
rs   = NA,
es   = NA) %>%
mutate(rs = enq_rs(temp = dwpt, pres = pres, find = "rs")$rs)%>%
mutate(es = enq_es(temp = dwpt, find = "es")$es)
for(i in 1:nrow(data)){
org_t = data$temp[i]
org_d = data$dwpt[i]
org_p = data$pres[i]
org_rs = data$rs[i]
ana_p = data$pres[i]
ana_t = data$temp[i]
ana_d = data$dwpt[i]
if(data$dwpt[i] > data$temp[i]){
while(ana_t < ana_d){
ana_p = ana_p + 5
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 6
while(ana_t < ana_d){
ana_p = ana_p + 2
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 3
while(ana_t < ana_d){
ana_p = ana_p + 0.02
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.03
while(ana_t < ana_d){
ana_p = ana_p + 0.002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.003
while(ana_t < ana_d){
ana_p = ana_p + 0.0002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p - 0.0003
while(ana_t < ana_d){
ana_p = ana_p + 0.00001
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
}
if(data$dwpt[i] < data$temp[i]){
while(ana_t > ana_d){
ana_p = ana_p - 5
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 6
while(ana_t > ana_d){
ana_p = ana_p - 2
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 3
while(ana_t > ana_d){
ana_p = ana_p - 0.02
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.03
while(ana_t > ana_d){
ana_p = ana_p - 0.002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.003
while(ana_t > ana_d){
ana_p = ana_p - 0.0002
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
ana_p = ana_p + 0.0003
while(ana_t > ana_d){
ana_p = ana_p - 0.00001
ana_t = enq_dabt(temp1 = org_t, pres1 = org_p, pres2 = ana_p, find = "temp")$temp2
ana_d = enq_rs(rs = org_rs, pres = ana_p, find = "temp")$temp
}
}
ana_a = (ana_t + ana_d) / 2
ana_p = enq_dabt(temp1 = org_t, pres1 = org_p, temp2 = ana_a, find = "pres")$pres2
data$lclp[i] = ana_p
data$lclt[i] = ana_a
}
#Start calculating the solution
#Calculate dwpt isohume
#rs = (ep * es) / (pres - es)
#rs1 = (ep * es1) / (pres1 - es1)
#rs2 = (ep * es2) / (pres2 - es2)
#if rs1 = rs2
#(ep * es1) / (pres1 - es1) = (ep * es2) / (pres2 - es2)
#(ep * es1) / (pres1 - es1) / ep = es2 / (pres2 - es2)
#(ep * es1) / ((pres1 - es1) * ep) = es2 / pres2 - 1
#es1 / (pres1 - es1) = es2 / pres2 - 1
#es1 / pres1 = es2 / pres2
####sub es into t
#es = e0 * exp((18.678 - (t/234.5)) * (t / (257.14 + t)))
#es1 = e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1)))
#es2 = e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))
#(e0 * exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) ) / pres1 =
#  (e0 * exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) ) / pres2
#let exp(...)1 be x1
#(e0 * x1) / pres1 = (e0 * x2) / pres2
#x1 / pres1 = x2 / pres2
#x1 / x2 = pres1 / pres2
#exp((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) / exp((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  pres1 / pres2
#exp(((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2)))) =
#  pres1 / pres2
#((18.678 - (t1/234.5)) * (t1 / (257.14 + t1))) - ((18.678 - (t2/234.5)) * (t2 / (257.14 + t2))) =
#  ln(pres1 / pres2)
#Calculate temp dabt
#pres2 = 10 ^ (log10(temp2K/ temp1K) / RdCp + 3)
return(data)
}
enq_lcl(c(10,21), 20, 1000)
enq_lcl(c(10,21), 20, 1000)
remove(enq_lcl)
library(hkweather)
enq_lcl(c(10,21), 20, 1000)
enq_lcl(c(10,21), c(20,20.9), 1000)
